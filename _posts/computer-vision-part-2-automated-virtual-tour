---
title: "Automated virtual tour"
author: Tuan
layout: post
permalink: /computer-vision-part-2-automated-virtual-tour/
disqus_page_identifier: computer-vision-part-2-automated-virtual-tour
published: false
---

![HDR Panorama](/public/images/cv2-cover.png)

Welcome back to 2nd part of the 3-part Computer Vision series at Oyster.com. If you have not seen our 1st part of the series, we would recommend you [check it out](http://tech.oyster.com/computer-vision-part-1-hdr-panorama), in that part we show how HDR (High Dynamic Range) panoramas are done at Oyster.com (including some comparisons of our panoramas vs Google.com panoramas).

In this part, we will share the behind-the-scene work of our recently added feature [Virtual walkthrough](https://www.oyster.com/french-polynesia/hotels/intercontinental-bora-bora-le-moana-resort/all-tours/pool--v35274/), or short as walkthrough.

We will first give an introduction of walkthrough, and why we need to build our own framework for this purpose. We will then jump right into the details of our computer vision system that generates walkthroughs from sets of panoramas. Lastly we will show some examples of walkthroughs on our sites for different indoor and outdoor scenarios.

## Generating walkthroughs from 2D panoramas
Walkthrough is a set of connected panoramas where users can navigate from panorama to another, this type of feature provides more interactive experience for users at remote sites. Walkthroughs can be generated by different approaches. One common approach is to use depth information to reconstruct the 3D scene for each panorama spot, like [Matterport](https://matterport.com), this provides seamless transition from scene to scene but it comes with high cost in purchasing their own special device and model hosting, in additional to its quality is not comparable to standard DLSR cameras. The more economic and more popular approach is the one that uses 2D panoramas to build walkthroughs based on popular 360 image viewers such as [Krpano](http://krpano.com/examples/vtour) to connect panoramas together. We build our framework to generate walkthroughs from sets of panoramas also based on Krpano, but in order to scale this approach for our huge database of hotels, we leverage Computer Vision techniques to automate the whole process from panoramas to completed walkthroughs.

## Automating walkthrough process
Our process starts with a set of HDR panoramas, finds the panoramas that are connected, estimates the relationship of those connected panoramas, and produces links that are integratable into a Krpano virtual tour's template project. The whole process has 3 main steps, namely disintegrating local views, matching and estimating panorama links, and integrating local links.

For a set of n panoramas, we carry out n * (n - 1) / 2 pano-pano matchings.

![Set of equirectangular panoramas as input](/public/images/cv2-pano-set.png)

### Disintegrating local views
In order to find



In this post, we have presented our approach to generating HDR panorama at large scale using available packages like DNGConverter, DCRAW, SNS-HDR, PTGui, and with the help from Computer Vision techniques with OpenCV. Please feel free to visit our website [Oyster](https://www.oyster.com) to see our rich collection of hotel panoramas all around the world. Also, please stay tuned for part 2 and 3 of this Computer Vision series, where we will show you how virtual tour can be generated (again fully automated at large scale) from a set of panoramas, and how smart features like mini-maps can be added to your tour to improve user experience.

### About the author:
Tuan Thi is a Senior Software Engineer in Computer Vision at [Oyster](https://www.oyster.com).com, part of Smarter Travel Media Group, at TripAdvisor. He finished his PhD in Computer Vision and Machine Learning in 2011.  Before joining TripAdvisor, he was a research engineer and computer vision scientist at Canon Research and Placemeter Ltd. with various international publications and patents in the field of local features, structured learning and deep learning.


